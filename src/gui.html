<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Diatopia-server</title>
    <meta
      http-equiv="Content-Security-Policy"
      content="script-src 'self' 'unsafe-inline';"
    />
  </head>
  <body style="background: white">
    <h1>Clients List</h1>
    <ul id="clients-list"></ul>
  </body>
  <script>
    // TODO: 1. add ws env & build tool to inject socket URI from env, 2. deploy to gitpage

    const addPlayer = (uid) => {
      const li = document.createElement("li");

      li.id = uid;
      li.textContent = uid;

      document.getElementById("clients-list").appendChild(li);
    };

    const addPlayers = (uids) => uids.forEach(addPlayer);

    const removePlayer = (uid) => {
      const li = document.getElementById(uid);

      document.getElementById("clients-list").removeChild(li);
    };

    const socket = new WebSocket("ws://localhost:3002/dashboard");
    socket.onmessage = function (event) {
      const { type, payload } = JSON.parse(event.data);

      switch (type) {
        case "clientConnect":
          addPlayers(payload);
          break;
        case "playerJoin":
          addPlayer(payload);
          break;
        case "playerLeave":
          removePlayer(payload);
          break;
        default:
          break;
      }
    };
  </script>
</html>
